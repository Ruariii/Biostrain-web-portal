<!DOCTYPE html>
{% extends 'base.html' %}
{% block content %}
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.0.1/dist/chart.umd.min.js"></script>
  <html lang="en">
  <head>
      <meta charset="UTF-8">
      <title>Squad Analysis</title>



  </head>
  <body>
  <div>
    {% for message in get_flashed_messages() %}

      <div class="alert alert-dark alert-dismissible fade show" role="alert">
        <strong>{{ message }}</strong>
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
      </div>

    {% endfor %}
    <br>
  </div>

  <h4> {{current_user.username|capitalize}} Squad View: {{ pro }} protocol</h4>
  <br><br>
  <div class="card">
  <h5 class="card-header">Featured: squad activity</h5>
  <div class="card-body">
    <h5 class="card-title">Activity log</h5>
    <p class="card-text">Monitor squad participation in {{ pro }} protocol.</p>
    <canvas id="activityChart" width="100%" height="40%"></canvas>
    <hr>
    <h5 class="card-title">Last 5 completed tests:</h5>
    <br>
    <table id="activityTable" class="table table-hover">
      <tr class="table-secondary">
        <th scope="col" style="text-align:center">  </th>
        <th scope="col" style="text-align:center"> Squad </th>
        <th scope="col" style="text-align:center"> User </th>
        <th scope="col" style="text-align:center"> Test date </th>
        <th scope="col" style="text-align:center"> Protocol </th>
        <th scope="col" style="text-align:center"> Transformational zone </th>
        <th scope="col" style="text-align:center"> Left peak force </th>
        <th scope="col" style="text-align:center"> Right peak force</th>
      </tr>
      <tr>
        <th scope="Row" style="text-align:center"> 1 </th>
        <td style="text-align:center"> {{ dataArrayHead[4][0] }} </td>
        <td style="text-align:center"> {{ dataArrayHead[4][1] }} </td>
        <td style="text-align:center"> {{ dataArrayHead[4][2] }} </td>
        <td style="text-align:center"> {{ dataArrayHead[4][3] }} </td>
        <td style="text-align:center"> {{ dataArrayHead[4][4] }} </td>
        <td style="text-align:center"> {{ dataArrayHead[4][5] }} kg </td>
        <td style="text-align:center"> {{ dataArrayHead[4][6] }} kg </td>
      </tr>
      <tr>
        <th scope="Row" style="text-align:center"> 2 </th>
        <td style="text-align:center"> {{ dataArrayHead[3][0] }} </td>
        <td style="text-align:center"> {{ dataArrayHead[3][1] }} </td>
        <td style="text-align:center"> {{ dataArrayHead[3][2] }} </td>
        <td style="text-align:center"> {{ dataArrayHead[3][3] }} </td>
        <td style="text-align:center"> {{ dataArrayHead[3][4] }} </td>
        <td style="text-align:center"> {{ dataArrayHead[3][5] }} kg </td>
        <td style="text-align:center"> {{ dataArrayHead[3][6] }} kg </td>
      </tr>
      <tr>
        <th scope="Row" style="text-align:center"> 3 </th>
        <td style="text-align:center"> {{ dataArrayHead[2][0] }} </td>
        <td style="text-align:center"> {{ dataArrayHead[2][1] }} </td>
        <td style="text-align:center"> {{ dataArrayHead[2][2] }} </td>
        <td style="text-align:center"> {{ dataArrayHead[2][3] }} </td>
        <td style="text-align:center"> {{ dataArrayHead[2][4] }} </td>
        <td style="text-align:center"> {{ dataArrayHead[2][5] }} kg </td>
        <td style="text-align:center"> {{ dataArrayHead[2][6] }} kg </td>
      </tr>
      <tr>
        <th scope="Row" style="text-align:center"> 4 </th>
        <td style="text-align:center"> {{ dataArrayHead[1][0] }} </td>
        <td style="text-align:center"> {{ dataArrayHead[1][1] }} </td>
        <td style="text-align:center"> {{ dataArrayHead[1][2] }} </td>
        <td style="text-align:center"> {{ dataArrayHead[1][3] }} </td>
        <td style="text-align:center"> {{ dataArrayHead[1][4] }} </td>
        <td style="text-align:center"> {{ dataArrayHead[1][5] }} kg </td>
        <td style="text-align:center"> {{ dataArrayHead[1][6] }} kg </td>
      </tr>
      <tr>
        <th scope="Row" style="text-align:center"> 5 </th>
        <td style="text-align:center"> {{ dataArrayHead[0][0] }} </td>
        <td style="text-align:center"> {{ dataArrayHead[0][1] }} </td>
        <td style="text-align:center"> {{ dataArrayHead[0][2] }} </td>
        <td style="text-align:center"> {{ dataArrayHead[0][3] }} </td>
        <td style="text-align:center"> {{ dataArrayHead[0][4] }} </td>
        <td style="text-align:center"> {{ dataArrayHead[0][5] }} kg </td>
        <td style="text-align:center"> {{ dataArrayHead[0][6] }} kg </td>
      </tr>
    </table>

  </div>
  </div>
  <br><br>

  <div class="card">
  <h5 class="card-header">Featured: top performers</h5>
  <div class="card-body">
    <h5 class="card-title"> High scores </h5>
    <p class="card-text">Take a look at the top performers in your squad.</p>
    <div class="row align-items-center">
    <div class="col">
      <p class="card-text"> <strong> Force at 150ms </strong></p>
    <canvas id="top150Chart" width="50%" height="35%"></canvas>
    </div>
    <div class="col">
      <p class="card-text"> <strong> Peak force </strong></p>
      <canvas id="topPeakChart" width="50%" height="35%"></canvas>
    </div>
    </div>
    <hr>
    <h5 class="card-title"> Asymmetry </h5>
    <p class="card-text"> Compare front leg & back leg asymmetry between squad members. </p>
    <p class="card-text">Asymmetry is positive when right transformational zone is greater than left.</p>
    <div class="row align-items-center">
    <div class="col">
      <p class="card-text"> <strong> Force at 150ms </strong></p>
    <canvas id="top150asymChart" width="40%" height="35%"></canvas>
    </div>
    <div class="col">
      <p class="card-text"> <strong> Peak force </strong></p>
      <canvas id="topPeakasymChart" width="40%" height="35%"></canvas>
    </div>
    </div>
  </div>
  </div>




  <script>
      const labels = {{ timeStr|safe }}
      const data = {
        labels: labels,
        datasets: [{
          label: 'Tests completed',
          data: {{ countExt|safe }},
          fill: true,
          borderColor: 'rgb(100, 75, 185)',
          tension: 0.05
        }]
      }

      new Chart(document.getElementById("activityChart"), {
          type: "line",
          data: data,
          options: {
            scales: {
                y:{
                  min:0,
                  max:20,
                  title:{
                    text: 'Number of completed tests',
                    display: true
                  }
                }
            }
          }
      });
    </script>

  <script>

      const labels2 = {{ players|safe }}

      const data2 = {
        labels: labels2,
        datasets: [{
          label: 'Combined force at 150ms',
          data: {{ best150|safe }},
          backgroundColor: 'rgb(130, 75, 140)'
        }
        ]
      }

      new Chart(document.getElementById("top150Chart"), {
      type: "bar",
      data: data2,
      options: {
        scales: {
            y:{
              min:0,
              max:300,
              title: {
                text: 'Force (kg)',
                display: true
              }
            }
        }
      }
  });
    </script>

  <script>

      const labels3 = {{ players|safe }}

      const data3 = {
        labels: labels3,
        datasets: [{
          label: 'Combined peak force',
          data: {{ bestPeak|safe }},
          backgroundColor: 'rgb(180, 75, 70)'
        }
        ]
      }

      new Chart(document.getElementById("topPeakChart"), {
      type: "bar",
      data: data3,
      options: {
        scales: {
            y:{
              min:0,
              max:300,
              title: {
                text: 'Force (kg)',
                display: true
              }

            }
        }
      }
  });
    </script>

  <script>

      const labels4 = {{ players|safe }}

      const data4 = {
        labels: labels4,
        datasets: [{
          label: 'Front leg',
          data: {{ FL150Asym|safe }},
          backgroundColor: 'rgb(130, 75, 140, 0.75)'
        },
        {
         label: 'Back leg',
          data: {{ BL150Asym|safe }},
          backgroundColor: 'rgb(130, 75, 140, 0.5)'
        }
        ]
      }

      new Chart(document.getElementById("top150asymChart"), {
      type: "bar",
      data: data4,
      options: {
        indexAxis: 'y',
        scales: {
            x:{
              max:50,
              min:-50,
              title: {
                text: 'Asymmetry (%)',
                display: true
              }

            }
        }
      }
  });
    </script>

  <script>

      const labels5 = {{ players|safe }}

      const data5 = {
        labels: labels5,
        datasets: [{
          label: 'Front leg',
          data: {{ FLpeakAsym|safe }},
          backgroundColor: 'rgb(180, 75, 70, 0.75)'
        },
        {
         label: 'Back leg',
          data: {{ BLpeakAsym|safe }},
          backgroundColor: 'rgb(180, 75, 70, 0.5)'
        }
        ]
      }

      new Chart(document.getElementById("topPeakasymChart"), {
      type: "bar",
      data: data5,
      options: {
        indexAxis: 'y',
        scales: {
            x:{
              max:50,
              min:-50,
              title: {
                text: 'Asymmetry (%)',
                display: true
              }

            }
        }
      }
  });
    </script>



  </body>
{% endblock %}
</html>
